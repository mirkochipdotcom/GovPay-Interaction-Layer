<VirtualHost *:443>
    ServerName ${APACHE_SERVER_NAME}

    DocumentRoot /var/www/html/public
    
    # --- AGGIUNTA PER LA SICUREZZA (Nascondere 403 Forbidden) ---
    # Definisce la pagina per l'errore 404 (Not Found)
    ErrorDocument 404 /errors/404.php
    
    # Reindirizza l'errore 403 (Forbidden) alla pagina 404
    # Questo nasconde la differenza tra "permesso negato" e "risorsa inesistente"
    ErrorDocument 403 /errors/404.php
    # -------------------------------------------------------------

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

   
    SSLEngine on
    SSLCertificateFile /ssl/server.crt
    SSLCertificateKeyFile /ssl/server.key

    # ----------------------------------------------------------------------
    # BLOCCO DI SICUREZZA: Impedisci l'accesso diretto a cartelle sensibili
    # ----------------------------------------------------------------------

    # Nega l'accesso alla cartella delle dipendenze Composer
    <Directory /var/www/html/vendor>
        Require all denied
    </Directory>

    # ----------------------------------------------------------------------
    # Fine Blocchi di Sicurezza
    # ----------------------------------------------------------------------

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Rewrite all non-file requests to the Slim front controller in the public folder
    <Directory /var/www/html/public>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted

        RewriteEngine On
        # If the request is not for an existing file or directory, rewrite to /index.php
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ /index.php [L,QSA]
    </Directory>
</VirtualHost>

<VirtualHost *:80>
    ServerName ${APACHE_SERVER_NAME}
    Redirect permanent / https://${APACHE_SERVER_NAME}/
</VirtualHost>
