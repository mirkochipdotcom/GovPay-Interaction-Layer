<VirtualHost *:443>
    ServerName ${APACHE_SERVER_NAME}

    DocumentRoot /var/www/html

    SSLEngine on
    SSLCertificateFile /ssl/server.crt
    SSLCertificateKeyFile /ssl/server.key

    # ----------------------------------------------------------------------
    # BLOCCO DI SICUREZZA: Impedisci l'accesso diretto a cartelle sensibili
    # ----------------------------------------------------------------------

    # Nega l'accesso alla cartella delle dipendenze Composer
    <Directory /var/www/html/vendor>
        Require all denied
    </Directory>

    # Nega l'accesso alla cartella dei moduli Node (anche se gestita dal Dockerfile)
    <Directory /var/www/html/node_modules>
        Require all denied
    </Directory>

    # Nega l'accesso al repository Git (cruciale)
    <Directory /var/www/html/.git>
        Require all denied
    </Directory>

    # Nega l'accesso a qualsiasi file di configurazione sensibile (.env, .htaccess, ecc.)
    <FilesMatch "^\.env$|^\.htaccess$|^\.htpasswd$">
        Require all denied
    </FilesMatch>
    
    # ----------------------------------------------------------------------
    # Fine Blocchi di Sicurezza
    # ----------------------------------------------------------------------

    <Directory /var/www/html>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>

<VirtualHost *:80>
    ServerName ${APACHE_SERVER_NAME}
    Redirect permanent / https://${APACHE_SERVER_NAME}/
</VirtualHost>
