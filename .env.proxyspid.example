# Configurazione INTEGRAZIONE Frontoffice <-> SPID/CIE Proxy
#
# Copia questo file in `.env.proxyspid` e personalizza:
#   cp .env.proxyspid.example .env.proxyspid
#
# Nota:
# - Questo file contiene SOLO configurazione applicativa (redirect/client/base url).
# - I dati che determinano il METADATA (org/attrs/cert/level/...) stanno in:
#     - .env.metadata

# ------------------------------------------------------------
# COME FUNZIONA IL REDIRECT (IMPORTANTE)
# ------------------------------------------------------------
# Il proxy decide DOVE inviare l'esito login in base al parametro `redirect_uri`
# presente nell'URL della pagina del proxy (proxy-home.php).
#
# Esempio:
#   https://<proxy>/proxy-home.php?...&redirect_uri=https%3A%2F%2F<frontoffice>%2Fspid%2Fcallback
#
# Regola fondamentale:
# - il valore passato come `redirect_uri` deve essere presente ESATTAMENTE in SPID_PROXY_REDIRECT_URIS
#   (whitelist lato proxy). Se non combacia, il login viene rifiutato.
#
# Errori tipici che rompono tutto:
# - http vs https
# - porta diversa
# - localhost vs 127.0.0.1
# - trailing slash diverso

# Nota Docker Compose:
# - nei file `env_file` Docker Compose NON espande espressioni tipo ${VAR} dentro i valori.
#   Quindi evita di scrivere concatenazioni come:
#     FRONTOFFICE_SPID_REDIRECT_URI=${FRONTOFFICE_PUBLIC_BASE_URL}${FRONTOFFICE_SPID_CALLBACK_PATH}
#   perché arriverebbero letterali nel container.

# ------------------------------------------------------------
# FRONT OFFICE (client che avvia il login e riceve la callback)
# ------------------------------------------------------------
# URL pubblico del frontoffice (usato per comporre la callback SPID).
FRONTOFFICE_PUBLIC_BASE_URL=https://localhost:8444

# Path della callback sul frontoffice.
FRONTOFFICE_SPID_CALLBACK_PATH=/spid/callback

# (opzionale) Redirect URI esplicito.
# Se vuoto, il frontoffice usa ${FRONTOFFICE_PUBLIC_BASE_URL}${FRONTOFFICE_SPID_CALLBACK_PATH}.
FRONTOFFICE_SPID_REDIRECT_URI=

# Esempio tipico DEV (locale):
#   FRONTOFFICE_PUBLIC_BASE_URL=https://localhost:8444
#   FRONTOFFICE_SPID_CALLBACK_PATH=/spid/callback
#   FRONTOFFICE_SPID_REDIRECT_URI=   (vuoto -> usa default nel codice)
#   SPID_PROXY_REDIRECT_URIS=https://localhost:8444/spid/callback,/proxy-sample.php

# Nota (reverse proxy / TLS terminato a monte):
# - SPID_PROXY_PUBLIC_BASE_URL deve essere l'URL con cui gli UTENTI raggiungono davvero il proxy.
# - se lo metti sbagliato, i link/redirect nei metadata possono risultare non validi.

# `serviceName` determina il baseurlpath di SimpleSAMLphp e quindi il prefisso moduli:
#   /<serviceName>/module.php/...
# Deve combaciare con la configurazione Apache del container (Alias/Rewrite).
#
# Endpoints dinamici (fallback) usati dal generator/Apache:
#   /<serviceName>/module.php/saml/sp/metadata.php/spid
#   /<serviceName>/module.php/saml/sp/metadata.php/cie
#
# Endpoints statici esposti (se i file current/next esistono):
#   ${SPID_PROXY_PUBLIC_BASE_URL}/spid-metadata.xml
#   ${SPID_PROXY_PUBLIC_BASE_URL}/cie-metadata.xml
#   ${SPID_PROXY_PUBLIC_BASE_URL}/spid-metadata-next.xml
#   ${SPID_PROXY_PUBLIC_BASE_URL}/cie-metadata-next.xml
#
# Nota: l'entityID NON è configurabile: è implicito dal modo in cui serviamo i metadata statici.
SPID_PROXY_SERVICE_NAME=myservice

# Abilitazioni (feature) del proxy
SPID_PROXY_ADD_SPID=1
SPID_PROXY_ADD_CIE=1

# Identificativo del client applicativo che usa il proxy.
SPID_PROXY_CLIENT_ID=govpay_client

# (opzionale) Secret condiviso tra frontoffice e proxy (necessario se abiliti cifratura response).
SPID_PROXY_CLIENT_SECRET=

# Whitelist redirect_uri lato proxy (match ESATTO).
# Deve includere la callback del frontoffice (URL assoluto) e qualsiasi path interno che usi in dev.
# Lista separata da virgole, senza spazi.
#
# Se lasci FRONTOFFICE_SPID_REDIRECT_URI vuoto, allora qui devi includere:
#   ${FRONTOFFICE_PUBLIC_BASE_URL}${FRONTOFFICE_SPID_CALLBACK_PATH}
# (valore calcolato dal codice, non da Compose).
SPID_PROXY_REDIRECT_URIS=https://localhost:8444/spid/callback,/proxy-sample.php

# ------------------------------------------------------------
# Branding UI del proxy (opzionale)
# ------------------------------------------------------------
SPID_PROXY_CLIENT_NAME=
SPID_PROXY_CLIENT_DESCRIPTION=
SPID_PROXY_CLIENT_LOGO=
