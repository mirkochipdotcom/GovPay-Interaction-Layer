{% extends 'base.html.twig' %}

{% block title %}Guida - {{ app_entity.name }}{% endblock %}

{% block content %}
  <div class="container-xxl py-4">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="d-flex align-items-start justify-content-between flex-wrap gap-3 mb-4">
          <div>
            <h1 class="h2 mb-2">Guida all'utilizzo</h1>
            <p class="text-muted mb-0">Come pagare un avviso, generare un pagamento spontaneo, usare il carrello e consultare le ricevute.</p>
          </div>
          <div class="text-end d-flex gap-2">
            <a class="btn btn-outline-warning" href="/carrello">
              <i class="fa-solid fa-cart-shopping me-1"></i>Carrello
              {% if cart_count|default(0) > 0 %}
                <span class="badge bg-warning text-dark ms-1">{{ cart_count }}</span>
              {% endif %}
            </a>
            {% if spid_enabled and current_user %}
              <a class="btn btn-outline-primary" href="/pendenze"><i class="fas fa-receipt me-2"></i>Le mie pendenze</a>
            {% endif %}
          </div>
        </div>

        <div class="p-4 border rounded-4 bg-white mb-4">
          <h2 class="h4 mb-3"><span class="badge bg-primary me-2">1</span>Pagare un avviso ricevuto</h2>
          <ol class="mb-3">
            <li class="mb-2">Apri <a href="/pagamento-avviso">Paga un avviso</a>.</li>
            <li class="mb-2">Inserisci <strong>codice avviso / IUV</strong> e <strong>codice fiscale / P.IVA</strong> dell'intestatario.</li>
            <li class="mb-2">Verifica importo e scadenza. Poi scegli una delle tre azioni:
              <ul class="mt-2">
                <li><strong>ðŸ›’ Aggiungi al carrello</strong> â€” per pagarlo insieme ad altri avvisi.</li>
                <li><strong>âš¡ Paga subito</strong> â€” redirect diretto a PagoPA per pagarlo immediatamente.</li>
                <li><strong>ðŸ–¨ Stampa / Scarica PDF</strong> â€” per stampare o pagare in un PSP fisico.</li>
              </ul>
            </li>
            <li>Al termine, salva la ricevuta digitale ricevuta via email.</li>
          </ol>
        </div>

        <div class="p-4 border rounded-4 bg-white mb-4">
          <h2 class="h4 mb-3"><span class="badge bg-primary me-2">2</span>Generare un pagamento spontaneo (senza avviso)</h2>
          <ol class="mb-3">
            <li class="mb-2">Apri <a href="/pagamento-spontaneo">Pagamento spontaneo</a>.</li>
            <li class="mb-2">Seleziona il servizio/causale e compila i dati richiesti.</li>
            <li class="mb-2">Inserisci l'importo e conferma: verrÃ  generato un avviso PagoPA.</li>
            <li>Scegli: <strong>Aggiungi al carrello</strong>, <strong>Paga subito</strong> o <strong>Stampa PDF</strong>.</li>
          </ol>
        </div>

        <div class="p-4 border rounded-4 bg-warning bg-opacity-10 border-warning mb-4">
          <h2 class="h4 mb-3"><span class="badge bg-warning text-dark me-2">3</span>Usare il carrello multi-pagamento</h2>
          <p class="mb-3">Il carrello ti permette di raccogliere fino a <strong>5 avvisi</strong> e pagarli tutti in una sola sessione PagoPA. Non Ã¨ necessario il login.</p>
          <ol class="mb-3">
            <li class="mb-2">Clicca <strong>Aggiungi al carrello</strong> su ogni avviso che vuoi pagare (trovato o generato).</li>
            <li class="mb-2">Il badge <span class="badge bg-warning text-dark">N</span> nella barra in alto si aggiorna automaticamente.</li>
            <li class="mb-2">Apri il <a href="/carrello">Carrello</a> per vedere il riepilogo e il totale.</li>
            <li class="mb-2">Clicca <strong>Procedi al pagamento</strong>: verrai portato su PagoPA per pagare tutti gli avvisi in una volta.</li>
            <li>Puoi rimuovere singoli avvisi dal carrello prima di pagare.</li>
          </ol>
        </div>

        {% if spid_enabled %}
        <div class="p-4 border rounded-4 bg-white mb-4">
          <h2 class="h4 mb-3"><span class="badge bg-primary me-2">4</span>Consultare pendenze e ricevute (richiede SPID)</h2>
          <p class="mb-3">La sezione <a href="/pendenze">Le mie pendenze</a> mostra le posizioni debitorie associate al tuo profilo.</p>
          <ul class="mb-0">
            <li class="mb-2">Puoi selezionare piÃ¹ pendenze pagabili direttamente dalla lista e cliccare <strong>Paga selezionate</strong>.</li>
            <li class="mb-2">Apri il dettaglio di una pendenza per scaricarne la ricevuta (se giÃ  pagata).</li>
            <li>Se non visualizzi pendenze attese, verifica che il codice fiscale del profilo sia corretto e riprova il login.</li>
          </ul>
        </div>
        {% endif %}

        <div class="p-4 border rounded-4 bg-light mb-4">
          <h2 class="h5 mb-2">Accesso e sicurezza</h2>
          {% if spid_enabled %}
            <p class="mb-0">
              Il pagamento da avviso e il carrello funzionano <strong>anche senza login</strong>. L'accesso con <strong>SPID/CIE</strong> Ã¨ necessario solo per la sezione "Le mie pendenze" e le ricevute.
              Se il login non va a buon fine, tenta di ripetere l'accesso o contatta l'assistenza.
            </p>
          {% else %}
            <p class="mb-0">In questo ambiente il login SPID/CIE non Ã¨ abilitato. Tutti i pagamenti avvengono senza autenticazione.</p>
          {% endif %}
        </div>

        <div class="p-4 border rounded-4 bg-white">
          <h2 class="h4 mb-3">Assistenza</h2>
          <p class="mb-2">Scrivi a <a href="mailto:{{ support_email }}">{{ support_email }}</a> oppure chiama {{ support_phone }} ({{ support_hours }}).</p>
          <p class="mb-0">{{ support_location|raw }}</p>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
