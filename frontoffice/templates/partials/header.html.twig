{# Header in stile Bootstrap Italia, semplificato e parametrizzato #}
<header class="it-header-wrapper">
  <div class="it-header-slim-wrapper">
    <div class="container-xxl">
      <div class="row">
        <div class="col-12">
          <div class="it-header-slim-wrapper-content">
            <a class="d-none d-lg-block navbar-brand text-white" href="#">{{ app_entity.name }}</a>
            <div class="it-header-slim-right-zone pe-0 w-100 justify-content-between justify-content-lg-end">
              <a class="btn {{ current_path starts with '/carrello' ? 'btn-light text-primary' : 'btn-primary' }} btn-sm me-auto me-lg-3 d-flex align-items-center py-1 px-2" href="/carrello" aria-label="Carrello ({{ cart_count|default(0) }} avvisi)" title="Carrello">
                <i class="fa-solid fa-cart-shopping"></i>
                <span class="badge rounded-pill {{ current_path starts with '/carrello' ? 'bg-primary text-white' : 'bg-light text-dark' }} ms-2 cart-badge" {% if cart_count|default(0) == 0 %}style="display:none;"{% endif %}>{{ cart_count|default(0) }}</span>
              </a>
              <div class="d-flex align-items-center">
                <div class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <span class="visually-hidden">Selezione lingua: lingua selezionata</span>
                  <span>{{ current_locale|upper }}</span>
                  <svg class="icon d-none d-lg-block"><use href="/assets/bootstrap-italia/svg/sprites.svg#it-expand"></use></svg>
                </a>
                <div class="dropdown-menu">
                  <div class="row">
                    <div class="col-12">
                      <div class="link-list-wrapper">
                        <ul class="link-list">
                          <li><a class="dropdown-item list-item {{ current_locale == 'it' ? 'active' : '' }}" href="?lang=it"><span>ITA {% if current_locale == 'it' %}<span class="visually-hidden">selezionata</span>{% endif %}</span></a></li>
                          <li><a class="dropdown-item list-item {{ current_locale == 'en' ? 'active' : '' }}" href="?lang=en"><span>ENG {% if current_locale == 'en' %}<span class="visually-hidden">selezionata</span>{% endif %}</span></a></li>
                          <li><a class="dropdown-item list-item {{ current_locale == 'es' ? 'active' : '' }}" href="?lang=es"><span>ESP {% if current_locale == 'es' %}<span class="visually-hidden">selezionata</span>{% endif %}</span></a></li>
                          <li><a class="dropdown-item list-item {{ current_locale == 'fr' ? 'active' : '' }}" href="?lang=fr"><span>FRA {% if current_locale == 'fr' %}<span class="visually-hidden">selezionata</span>{% endif %}</span></a></li>
                          <li><a class="dropdown-item list-item {{ current_locale == 'de' ? 'active' : '' }}" href="?lang=de"><span>DEU {% if current_locale == 'de' %}<span class="visually-hidden">selezionata</span>{% endif %}</span></a></li>
                        </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="it-access-top-wrapper">
                 {% if current_user %}
                <div class="it-user-wrapper nav-item dropdown show">
                  <a aria-expanded="false" class="btn btn-primary btn-icon btn-full" data-bs-toggle="dropdown" href="#" id="userDropdown">
                    {% set first = current_user.first_name|default('') %}
                    {% set last = current_user.last_name|default('') %}
                    {% set show_name = (first != '') or (last != '') %}
                    {% set display_name = first ~ (last != '' ? ' ' ~ last|upper : '') %}
                    {% set initials = (first|slice(0,1)) ~ (last|slice(0,1)) %}
                    {% if show_name -%}
                      <span class="d-none d-md-inline">{{ display_name }}</span>
                    {% else -%}
                      <span class="d-none d-md-inline">{{ current_user.email }}</span>
                    {% endif %}
                    <span class="badge bg-light text-dark ms-2 d-none d-md-inline" aria-hidden="false" aria-label="{{ display_name != '' ? display_name : current_user.email }}">{{ initials|upper }}</span>
                    <span class="d-inline d-md-none user-initials-avatar ms-2 d-flex align-items-center justify-content-center" role="img" aria-label="{{ display_name != '' ? display_name : current_user.email }}">{{ initials|upper }}</span>
                    <svg class="icon icon-white d-none d-lg-block ms-2" style="width:18px;height:18px;">
                      <use xlink:href="/assets/bootstrap-italia/svg/sprites.svg#it-expand"></use>
                    </svg>
                  </a>
                  <div class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <div class="row">
                      <div class="col-12">
                        <div class="link-list-wrapper px-3 py-2">
                          <ul class="link-list list-unstyled mb-0">
                            <li>
                              <a class="list-item d-block text-dark py-1 {{ current_path == '/profile' ? 'active' : '' }}" href="/profile">{{ 'Profilo'|trans }}</a>
                            </li>
                            <li>
                              <a class="list-item d-block text-dark py-1 {{ current_path == '/pendenze' ? 'active' : '' }}" href="/pendenze">{{ 'Le mie pendenze'|trans }}</a>
                            </li>
                            <li>
                              <a class="list-item d-block text-danger py-1" href="/logout">{{ 'Logout'|trans }}</a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                {% else %}
                  {% if spid_enabled %}
                    <a class="btn btn-primary btn-sm" href="/login">{{ 'Accedi'|trans }}</a>
                  {% endif %}
                {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="it-nav-wrapper">
    <div class="it-header-center-wrapper">
      <div class="container-xxl">
        <div class="row">
          <div class="col-12">
            <div class="it-header-center-content-wrapper">
              <div class="it-brand-wrapper">
                <a href="/">
                  {% if app_logo.type == 'img' %}
                    <img src="{{ app_logo.src }}" alt="{{ app_entity.name }}" class="me-2" style="height:40px; width:auto;" />
                  {% else %}
                    <svg class="icon icon-white me-2" style="height:40px; width:40px;">
                      <use xlink:href="{{ app_logo.src ?: '/assets/bootstrap-italia/svg/sprites.svg#it-pa' }}"></use>
                    </svg>
                  {% endif %}
                  <div class="it-brand-text">
                    <div class="it-brand-title">{{ app_entity.name }} - {{ 'Portale PagoPA'|trans }}</div>
                    <div class="it-brand-tagline d-none d-md-block">{{ app_entity.suffix }}</div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="it-header-navbar-wrapper">
      <div class="container-xxl">
        <div class="row">
          <div class="col-12">
            <nav class="navbar navbar-expand-lg has-megamenu" aria-label="Navigazione principale">
              <button class="custom-navbar-toggler" type="button" data-bs-toggle="navbarcollapsible" data-bs-target="#navC1" aria-controls="navC1" aria-label="Mostra/Nascondi la navigazione">
                <svg class="icon">
                  <use href="/assets/bootstrap-italia/svg/sprites.svg#it-burger"></use>
                </svg>
              </button>
              <div class="navbar-collapsable" id="navC1" tabindex="-1">
                <div class="close-div">
                  <button class="btn close-menu" type="button">
                    <span class="visually-hidden">Nascondi la navigazione</span>
                    <svg class="icon">
                      <use href="/assets/bootstrap-italia/svg/sprites.svg#it-close-big"></use>
                    </svg>
                  </button>
                </div>
                <div class="menu-wrapper">
                  <ul class="navbar-nav">
                    <li class="nav-item">
                      <a class="nav-link {{ current_path == '/' ? 'active' : '' }}" href="/"><span>{{ 'Home'|trans }}</span></a>
                    </li>
                    {% set in_pagamento_avviso = current_path starts with '/pagamento-avviso' %}
                    <li class="nav-item">
                      <a class="nav-link {{ in_pagamento_avviso ? 'active' : '' }}" href="/pagamento-avviso"><span>{{ 'Paga un avviso'|trans }}</span></a>
                    </li>
                    {% set in_pagamento_spontaneo = current_path starts with '/pagamento-spontaneo' %}
                    <li class="nav-item">
                      <a class="nav-link {{ in_pagamento_spontaneo ? 'active' : '' }}" href="/pagamento-spontaneo"><span>{{ 'Pagamento spontaneo'|trans }}</span></a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link {{ current_path == '/guida' ? 'active' : '' }}" href="/guida"><span>{{ 'Guida'|trans }}</span></a>
                    </li>
                    {% if spid_enabled and current_user %}
                      {% set in_pendenze = current_path starts with '/pendenze' %}
                      <li class="nav-item">
                        <a class="nav-link {{ in_pendenze ? 'active' : '' }}" href="/pendenze"><span>{{ 'Le mie pendenze'|trans }}</span></a>
                      </li>
                    {% endif %}

                  </ul>
                </div>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
