# SPID/CIE - variabili dedicate
# Copia questo file in .env.spid e personalizza:
#   cp .env.spid.example .env.spid
#
# Nota: il file .env.spid viene caricato come env_file SOLO nei servizi:
# - govpay-interaction-frontoffice
# - spid-proxy
#
# Le variabili di Docker Compose (porte, COMPOSE_PROFILES, ecc.) restano in .env.

# -----------------------------
# COME COMPILARE QUESTO FILE
# -----------------------------
# Obiettivo: far sì che il flusso sia coerente tra:
# - Frontoffice: endpoint di callback (dove il proxy POSTa l'esito login)
# - SPID Proxy: lista di redirect autorizzati + base URL pubblico (metadata/entityId)
#
# Minimo indispensabile (DEV):
# 1) Imposta il callback del frontoffice (FRONTOFFICE_PUBLIC_BASE_URL + FRONTOFFICE_SPID_CALLBACK_PATH)
# 2) Assicurati che quel callback compaia in SPID_PROXY_REDIRECT_URIS (match esatto)
# 3) Imposta SPID_PROXY_PUBLIC_BASE_URL coerente con dove raggiungi il proxy dall'esterno (o dal browser)

# ------------------------------------------------------------
# VALIDAZIONE METADATA (IMPORTANTE)
# ------------------------------------------------------------
# Questo progetto genera metadata da Service Provider (SP) SPID “standard” (pubblico o privato).
# Non è pensato per Aggregatori: se nel validator selezioni un profilo aggregatore (es. "pub-ag-full"),
# otterrai errori su campi/estensioni "aggregator/aggregated" che NON devono essere presenti per uno SP.
#
# Quindi, nel validator scegli un profilo di tipo:
# - Service Provider PUBBLICO se nel metadata vedi l'estensione <spid:Public/>
# - Service Provider PRIVATO se nel metadata vedi l'estensione <spid:Private/>
#
# Esempio tipico DEV in locale:
# - frontoffice: https://localhost:8444
# - proxy:       https://localhost:8445
#
#   FRONTOFFICE_PUBLIC_BASE_URL=https://localhost:8444
#   FRONTOFFICE_SPID_CALLBACK_PATH=/spid/callback
#   SPID_PROXY_PUBLIC_BASE_URL=https://localhost:8445
#   SPID_PROXY_REDIRECT_URIS=https://localhost:8444/spid/callback,/proxy-sample.php
#
# Se invece pubblichi il proxy su un dominio (reverse proxy / DNS), usa quel dominio:
#   SPID_PROXY_PUBLIC_BASE_URL=https://login.example.it
#   (e lascia comunque nei redirect il callback reale del frontoffice)

# ------------------------------------------------------------
# FRONT OFFICE (client che avvia il login e riceve la callback)
# ------------------------------------------------------------
# Frontoffice - URL pubblico (usato per comporre il callback SPID).
# Se lasci vuoto, il frontoffice prova a dedurlo da Host/HTTPS della richiesta.
# Esempio: https://localhost:8444
FRONTOFFICE_PUBLIC_BASE_URL=https://localhost:8444

# Path della callback sul frontoffice.
# Esempio: /spid/callback
FRONTOFFICE_SPID_CALLBACK_PATH=/spid/callback

# (opzionale) Redirect URI esplicito per SPID.
# Se lo imposti, deve essere presente anche in SPID_PROXY_REDIRECT_URIS (match esatto).
# Se NON lo imposti, il frontoffice usa di norma:
#   ${FRONTOFFICE_PUBLIC_BASE_URL}${FRONTOFFICE_SPID_CALLBACK_PATH}
# Esempio: https://localhost:8444/spid/callback
FRONTOFFICE_SPID_REDIRECT_URI=

# ------------------------------
# SPID PROXY (interno/esterno)
# ------------------------------
# SPID Proxy (interno o esterno)
# Base URL pubblico del proxy (usato per i link nei metadata e per i redirect HTTP->HTTPS).
# Esempi:
#  - https://login.my-domain.it/
#  - https://localhost:8445   (DEV in locale con certificato self-signed)
SPID_PROXY_PUBLIC_BASE_URL=https://localhost:8445

# EntityID del Proxy SP (di default: ${SPID_PROXY_PUBLIC_BASE_URL}/spid-metadata.xml)
# Lascia vuoto per usare il default.
# Esempio: https://login.example.it/spid-metadata.xml
SPID_PROXY_ENTITY_ID=

# Configurazione client applicativo che usa il proxy (es. GovPay Frontoffice)
# redirect_uri: lista separata da virgola.
# - Può contenere URL assoluti (consigliato, soprattutto se frontoffice ha un dominio pubblico)
# - Può contenere path relativi (es. /proxy-sample.php) che il proxy risolve su SPID_PROXY_PUBLIC_BASE_URL
# IMPORTANTE: deve includere il callback del frontoffice (match esatto), altrimenti il proxy rifiuta il redirect.
# Esempio:
#   SPID_PROXY_REDIRECT_URIS=https://localhost:8444/spid/callback,/proxy-sample.php

# Identificativo del client applicativo.
# Esempio: govpay_frontoffice
SPID_PROXY_CLIENT_ID=govpay_client

# (opzionale) Se vuoi cifrare la response via proxy, imposta anche il secret del client.
# Esempio: change_me_very_secret
SPID_PROXY_CLIENT_SECRET=

# Redirect autorizzati per il client (lista separata da virgola).
# - Metti SEMPRE il callback del frontoffice come URL assoluto (consigliato).
# - Puoi aggiungere path relativi (es. /proxy-sample.php) per pagine demo sul proxy.
# Esempio:
#   SPID_PROXY_REDIRECT_URIS=https://localhost:8444/spid/callback,/proxy-sample.php
SPID_PROXY_REDIRECT_URIS=/proxy-sample.php

# SPID Proxy - Setup non interattivo (generazione vendor/config/metadata al primo avvio)
# Nota: molte impostazioni vengono “materializzate” su disco al primo avvio (volume del proxy).
# Se modifichi variabili che influenzano metadata/cert/config dopo il primo avvio, potresti dover:
# - eliminare solo il volume/directory dati del proxy e riavviare (NON il DB), oppure
# - eseguire la procedura di setup nel container.
SPID_PROXY_SERVICE_NAME=myservice

# (manutenzione) Forza rigenerazione setup/metadata al prossimo avvio del container spid-proxy.
# Utile quando cambi variabili come SPID_PROXY_PUBLIC_BASE_URL / SPID_PROXY_ENTITY_ID / ORG_* e vuoi
# rigenerare configurazioni persistite senza cancellare a mano tutto il volume.
# ATTENZIONE: per applicare nuove env ai container esistenti NON basta `docker compose restart`:
# bisogna ricreare il container (es. `docker compose up -d --force-recreate spid-proxy`).
# Esempio d'uso:
#   SPID_PROXY_FORCE_SETUP=1  (fai un up --force-recreate)
#   poi rimetti SPID_PROXY_FORCE_SETUP=0
SPID_PROXY_FORCE_SETUP=0

# (opzionale) Se 1, oltre al setup elimina anche i certificati SPID in /var/www/spid-cie-php/cert.
# Questo cambia la chiave/certificato del Service Provider: da usare solo se sai cosa stai facendo.
SPID_PROXY_FORCE_CERT=0

# 1 = produzione, 0 = sviluppo.
# Esempio: 0
SPID_PROXY_PRODUCTION=0

# Abilitazioni
# 1 = abilita SPID, 0 = disabilita.
# Esempio: 1
SPID_PROXY_ADD_SPID=1

# 1 = abilita CIE, 0 = disabilita.
# Esempio: 0
SPID_PROXY_ADD_CIE=0

# IdP preconfigurati (utile in dev)
# In produzione in genere vanno disabilitati (0) e configurati solo gli IdP reali.
SPID_PROXY_ADD_DEMO_IDP=1
SPID_PROXY_ADD_DEMO_VALIDATOR_IDP=1
SPID_PROXY_ADD_AGID_VALIDATOR_IDP=1
# (opzionale) URL metadata IdP locale test
# Esempio: https://idp-test.local/metadata
SPID_PROXY_LOCAL_TEST_IDP_METADATA_URL=

# Attributi richiesti in metadata (lista separata da virgola)
# Esempio: spidCode,name,familyName,fiscalNumber,email
SPID_PROXY_ATTRS=spidCode,name,familyName,fiscalNumber,email

# SimpleSAMLphp (admin/secretsalt)
# Password dell'utente admin di SimpleSAMLphp (pannello admin del proxy).
# Esempio: admin
SPID_PROXY_SIMPLESAMLPHP_ADMIN_PASSWORD=admin

# Se vuoto viene generato automaticamente al primo avvio
# Esempio: 9f1c2d3e4a5b6c7d
SPID_PROXY_SIMPLESAMLPHP_SECRETSALT=

# Dati organizzazione nel metadata/cert (default: derivano da APP_ENTITY_NAME / ID_DOMINIO / URL_ENTE)
# Per avere metadata “puliti” e pronti per accreditamento, valorizza almeno i campi essenziali:
# - SPID_PROXY_ORG_NAME, SPID_PROXY_ORG_DISPLAY_NAME, SPID_PROXY_ORG_URL
# e i codici organizzazione coerenti con la tua natura (PA vs privato).

# Ragione sociale / nome ente nel metadata.
# Esempio: Comune di Esempio
SPID_PROXY_ORG_NAME=

# Nome visualizzato (display) nel metadata.
# Esempio: Comune di Esempio
SPID_PROXY_ORG_DISPLAY_NAME=

# Sito web dell'ente/organizzazione.
# Esempio: https://www.comune.esempio.it
SPID_PROXY_ORG_URL=

# Organizzazione: PA o privato
# 1 = Pubblica Amministrazione, 0 = privato
# Esempio: 1
SPID_PROXY_ORG_IS_PUBLIC_ADMIN=1

# Codici organizzazione (per PA: IPACode, per privati: VATNumber/FiscalCode)
# Se non valorizzati, fallback su ID_DOMINIO

# Tipo codice organizzazione.
# - PA: IPACode PA:IT-c_h501
# - Privato: VATNumber (P.IVA) oppure FiscalCode (CF)
# Esempi: IPACode | VATNumber | FiscalCode
SPID_PROXY_ORG_CODE_TYPE=

# Valore del codice organizzazione coerente con il type.
# - Se SPID_PROXY_ORG_CODE_TYPE=IPACode: qui va il CODICE IPA dell'ente (es. "c_h501")
# - Se VATNumber: solo numeri P.IVA (es. "01234567890")
# - Se FiscalCode: CF (es. "RSSMRA80A01H501U")
SPID_PROXY_ORG_CODE=

# Identificativo nel formato atteso dai metadata.
# Per PA, spesso è in forma: PA:IT-<CODICE_FISCALE_ENTE>
# Esempio: PA:IT-01234567890
SPID_PROXY_ORG_IDENTIFIER=

# Codice fiscale dell'organizzazione.
# Esempio: 01234567890
SPID_PROXY_ORG_FISCAL_CODE=

# Codice NACE2 (settore attività). Tipicamente richiesto per privati.
# Esempio: 84.11
SPID_PROXY_ORG_NACE2_CODE=84.11

# Localizzazione (valori richiesti dalla procedura di setup)
# Paese ISO (es. IT)
SPID_PROXY_ORG_COUNTRY=IT

# Località generica (può essere una città)
# Esempio: Montesilvano
SPID_PROXY_ORG_LOCALITY=Locality

# Codice catastale del comune (se applicabile)
# Esempio: H501
SPID_PROXY_ORG_MUNICIPALITY=H501

# Provincia (sigla)
# Esempio: PE
SPID_PROXY_ORG_PROVINCE=RM

# Contatti (dev default). Per prod usa contatti reali.
# Esempio: info@comune.esempio.it
SPID_PROXY_ORG_EMAIL=info@organization.org

# Esempio: +390851234567
SPID_PROXY_ORG_PHONE=+3912345678

# File di esempio (www/)
# Nota: in contesti "proxy" spesso non servono, ma puoi abilitarli se vuoi pagine demo.
SPID_PROXY_ADD_EXAMPLES=0
SPID_PROXY_ADD_PROXY_EXAMPLE=1

# Campi FPA (necessari solo se SPID_PROXY_ORG_IS_PUBLIC_ADMIN=0)
# Nota: compila SOLO se sei privato (SPID_PROXY_ORG_IS_PUBLIC_ADMIN=0).
# I valori dipendono dai dati anagrafici dell'azienda.

# Paese (ISO) della partita IVA (tipicamente IT)
# Esempio: IT
SPID_PROXY_FPA_ID_PAESE=IT

# Codice/numero di partita IVA (senza prefisso paese)
# Esempio: 01234567890
SPID_PROXY_FPA_ID_CODICE=

# Denominazione azienda
# Esempio: Azienda S.r.l.
SPID_PROXY_FPA_DENOMINAZIONE=

# Indirizzo sede
# Esempio: Via Roma
SPID_PROXY_FPA_INDIRIZZO=

# Civico
# Esempio: 1
SPID_PROXY_FPA_NUMERO_CIVICO=

# CAP
# Esempio: 00100
SPID_PROXY_FPA_CAP=

# Comune
# Esempio: Roma
SPID_PROXY_FPA_COMUNE=

# Provincia (sigla)
# Esempio: RM
SPID_PROXY_FPA_PROVINCIA=RM

# Nazione (ISO)
# Esempio: IT
SPID_PROXY_FPA_NAZIONE=IT

# Nome organizzazione (se richiesto dal profilo privati)
# Esempio: Azienda S.r.l.
SPID_PROXY_FPA_ORG_NAME=
SPID_PROXY_FPA_ORG_EMAIL=info@organization.org
SPID_PROXY_FPA_ORG_PHONE=+3912345678

# Proxy response
# Di default il proxy firma la response. La cifratura (encrypt) richiede tipicamente il secret lato client.

# 1 = firma la response, 0 = no
# Esempio: 1
SPID_PROXY_SIGN_RESPONSE=1

# 1 = cifra la response, 0 = no (richiede di norma SPID_PROXY_CLIENT_SECRET)
# Esempio: 0
SPID_PROXY_ENCRYPT_RESPONSE=0

# Livello SPID richiesto (tipicamente 1/2/3)
# Esempio: 2
SPID_PROXY_LEVEL=2

# Indice attributi/attributi certificati (dipende dal profilo). In dev può restare 0.
# Esempio: 0
SPID_PROXY_ATCS_INDEX=0

# Durata token (secondi)
# Esempio: 1200
SPID_PROXY_TOKEN_EXP_TIME=1200

# Prefisso applicato ai nomi attributo in response (se vuoi namespacing)
# Esempio: spid_
SPID_PROXY_RESPONSE_ATTR_PREFIX=
