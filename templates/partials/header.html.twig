{# Header in stile Bootstrap Italia, semplificato e parametrizzato #}
<header class="it-header-wrapper">
  <div class="it-header-slim-wrapper theme-dark">
    <div class="container">
      <div class="row">
        <div class="col-12">
            <div class="it-header-slim-wrapper-content d-flex justify-content-between align-items-center">
            <a class="d-lg-block navbar-brand text-white" href="#">{{ app_entity.government ?: app_entity.suffix }}</a>
            <div class="it-header-slim-right-zone d-flex align-items-center gap-3">
              {% if current_user %}
                <div class="it-user-wrapper nav-item dropdown show">
                  <a aria-expanded="false" class="btn btn-primary btn-icon btn-full" data-bs-toggle="dropdown" href="#" id="userDropdown">
                    <span class="fal me-2"><i class="fas fa-circle-user fa-xl" aria-hidden="true"></i></span>
                    <span class="d-none d-md-inline">{{ current_user.email }}</span>
                    <svg class="icon icon-white d-none d-lg-block ms-2" style="width:18px;height:18px;">
                      <use xlink:href="/assets/bootstrap-italia/svg/sprites.svg#it-expand"></use>
                    </svg>
                  </a>
                  <div class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <div class="row">
                      <div class="col-12">
                        <div class="link-list-wrapper px-3 py-2">
                          <ul class="link-list list-unstyled mb-0">
                            <li>
                              <a class="list-item d-block text-dark py-1 {{ current_path == '/profile' ? 'active' : '' }}" href="/profile">Profilo</a>
                            </li>
                            <li>
                              <a class="list-item d-block text-danger py-1" href="/logout">Logout</a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {% else %}
                <a class="btn btn-sm btn-outline-light" href="/login">Login</a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="it-nav-wrapper">
    <div class="it-header-center-wrapper theme-dark">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="it-header-center-content-wrapper d-flex justify-content-between align-items-center py-2">
              <div class="it-brand-wrapper d-flex align-items-center">
                {% if app_logo.type == 'img' %}
                  <img src="{{ app_logo.src }}" alt="{{ app_entity.name }}" class="me-2" style="height:40px; width:auto;" />
                {% else %}
                  <svg class="icon icon-white me-2" style="height:40px; width:40px;">
                    <use xlink:href="{{ app_logo.src }}"></use>
                  </svg>
                {% endif %}
                <div class="it-brand-text text-white">
                  <h2 class="no_toc h5 mb-0">{{ app_entity.name }}</h2>
                  <h3 class="no_toc h6 mb-0 d-none d-md-block">{{ app_entity.suffix }}</h3>
                </div>
              </div>
              <div class="it-right-zone">
                {# spazio per messaggi o pulsanti #}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div class="it-header-navbar-wrapper theme-dark">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <nav class="navbar navbar-expand-lg has-megamenu">
              <button class="custom-navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <svg class="icon"><use xlink:href="/assets/bootstrap-italia/svg/sprites.svg#it-burger"></use></svg>
              </button>
              <div class="navbar-collapsable collapse" id="mainNav">
                <div class="menu-wrapper">
                  <ul class="navbar-nav">
                    {% if current_user %}
                      <li class="nav-item"><a class="nav-link {{ current_path == '/' ? 'active' : '' }}" href="/">Home</a></li>
                      {% set in_pendenze = current_path starts with '/pendenze' %}
                      <li class="nav-item dropdown {{ in_pendenze ? 'active' : '' }}">
                        <a class="nav-link dropdown-toggle {{ in_pendenze ? 'active' : '' }}" href="#" id="pendenzeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          Pendenze
                        </a>
                        <div class="dropdown-menu" aria-labelledby="pendenzeDropdown">
                          <a class="dropdown-item {{ current_path == '/pendenze/ricerca' ? 'active' : '' }}" href="/pendenze/ricerca">Ricerca</a>
                          <a class="dropdown-item {{ current_path == '/pendenze/inserimento' ? 'active' : '' }}" href="/pendenze/inserimento">Inserimento</a>
                          <a class="dropdown-item {{ current_path == '/pendenze/inserimento-massivo' ? 'active' : '' }}" href="/pendenze/inserimento-massivo">Inserimento massivo</a>
                        </div>
                      </li>
                      {% set in_pagamenti = current_path starts with '/pagamenti' %}
                      <li class="nav-item dropdown {{ in_pagamenti ? 'active' : '' }}">
                        <a class="nav-link dropdown-toggle {{ in_pagamenti ? 'active' : '' }}" href="#" id="pagamentiDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                          Pagamenti
                        </a>
                        <div class="dropdown-menu" aria-labelledby="pagamentiDropdown">
                          <a class="dropdown-item {{ current_path == '/pagamenti/ricerca-incassi' ? 'active' : '' }}" href="/pagamenti/ricerca-incassi">Ricerca Incassi</a>
                          <a class="dropdown-item {{ current_path == '/pagamenti/ricerca-flussi' ? 'active' : '' }}" href="/pagamenti/ricerca-flussi">Ricerca Flussi</a>
                        </div>
                      </li>
                    {% endif %}
                    {% if current_user %}
                      {% if current_user.role in ['admin','superadmin'] %}
                        <li class="nav-item"><a class="nav-link {{ current_path starts with '/users' ? 'active' : '' }}" href="/users">Utenti</a></li>
                      {% endif %}
                      {% if current_user.role == 'superadmin' %}
                        {% set in_config = current_path starts with '/configurazione' %}
                        <li class="nav-item">
                          <a class="nav-link {{ in_config ? 'active' : '' }}" href="/configurazione">Configurazione</a>
                        </li>
                      {% endif %}
                    {% endif %}
                    <li class="nav-item"><a class="nav-link {{ current_path == '/guida' ? 'active' : '' }}" href="/guida">Guida</a></li>
                    {% if not current_user %}
                      <li class="nav-item"><a class="nav-link" href="/login">Login</a></li>
                    {% endif %}
                  </ul>
                </div>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
